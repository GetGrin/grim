on:
  workflow_call:
    inputs:
      version:
        required: true
        type: string

jobs:
  release:
    runs-on: ubuntu
    steps:
      - uses: actions/checkout@v6
        with:
          submodules: recursive
      - run: mkdir release
      - name: Release MacOS Universal
        run: |
          cargo zigbuild --release --target universal2-apple-darwin
          mv target/universal2-apple-darwin/release/grim macos/Grim.app/Contents/MacOS
      - name: Archive Universal
        working-directory: macos
        run: |
          zip -r grim-${{ inputs.version }}-macos.zip Grim.app
          mv grim-${{ inputs.version }}-macos.zip ../release
      - name: Checksum Release Universal
        working-directory: release
        run: sha256sum grim-${{ inputs.version }}-macos.zip > grim-${{ inputs.version }}-macos-sha256sum.txt
      - uses: actions/upload-artifact@v4
        with:
          name: release_macos
          path: release/*